{% extends "base.html" %} {% block content %}
<div class="card">
  <h2>ğŸ’° Add New Expense</h2>
  <form method="POST" class="expense-form">
    <div class="form-group">
      <label for="amount">ğŸ’µ Amount (â‚¹)</label>
      <input
        type="number"
        id="amount"
        name="amount"
        step="0.01"
        min="0"
        required
        placeholder="Enter amount..."
      />
    </div>
    <div class="form-group">
      <label for="category">ğŸ·ï¸ Category</label>
      <select id="category" name="category">
        <option value="Food">ğŸ• Food</option>
        <option value="Transportation">ğŸš— Transportation</option>
        <option value="Entertainment">ğŸ¬ Entertainment</option>
        <option value="Shopping">ğŸ›ï¸ Shopping</option>
        <option value="Bills">ğŸ“„ Bills</option>
        <option value="Healthcare">ğŸ¥ Healthcare</option>
        <option value="Education">ğŸ“š Education</option>
        <option value="Travel">âœˆï¸ Travel</option>
        <option value="Other">ğŸ“¦ Other</option>
      </select>
    </div>
    <div class="form-group">
      <label for="note">ğŸ“ Note (optional)</label>
      <input
        type="text"
        id="note"
        name="note"
        placeholder="What was this expense for?"
      />
    </div>
    <div class="form-group">
      <label for="date">ğŸ“… Date</label>
      <input
        type="date"
        id="date"
        name="date"
        value="{{ moment().format('YYYY-MM-DD') if moment else '' }}"
      />
    </div>
    <button type="submit" class="btn btn-primary">â• Add Expense</button>
  </form>
</div>

<div class="card">
  <h2>ğŸ“Š Recent Expenses</h2>
  {% if expenses %}
  <div class="expenses-summary">
    <div class="summary-stats">
      <div class="stat">
        <span class="label">ğŸ’° Total (last 20)</span>
        <span class="value">â‚¹{{ '%.2f'|format(expenses|sum(attribute='amount')) }}</span>
      </div>
      <div class="stat">
        <span class="label">ğŸ“ˆ Count</span>
        <span class="value">{{ expenses|length }}</span>
      </div>
      <div class="stat">
        <span class="label">ğŸ“… Latest</span>
        <span class="value">{{ expenses[0].created_at.strftime('%m/%d') if expenses else 'N/A' }}</span>
      </div>
    </div>
  </div>
  <div style="overflow-x: auto;">
    <table class="expenses">
      <thead>
        <tr>
          <th>ğŸ“… Date</th>
          <th>ğŸ·ï¸ Category</th>
          <th>ğŸ“ Note</th>
          <th>ğŸ’° Amount</th>
        </tr>
      </thead>
      <tbody>
        {% for e in expenses %}
        <tr>
          <td>{{ e.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
          <td>
            {% if e.category == 'Food' %}ğŸ•
            {% elif e.category == 'Transportation' %}ğŸš—
            {% elif e.category == 'Entertainment' %}ğŸ¬
            {% elif e.category == 'Shopping' %}ğŸ›ï¸
            {% elif e.category == 'Bills' %}ğŸ“„
            {% elif e.category == 'Healthcare' %}ğŸ¥
            {% elif e.category == 'Education' %}ğŸ“š
            {% elif e.category == 'Travel' %}âœˆï¸
            {% else %}ğŸ“¦{% endif %}
            {{ e.category }}
          </td>
          <td>{{ e.note or '-' }}</td>
          <td class="amount">â‚¹{{ '%.2f'|format(e.amount) }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% else %}
  <div style="text-align: center; padding: 40px; color: #718096;">
    <div style="font-size: 4rem; margin-bottom: 20px;">ğŸ“</div>
    <h3 style="margin: 0 0 10px 0; color: #4a5568;">No expenses yet!</h3>
    <p style="margin: 0;">Add your first expense above to get started with tracking your spending.</p>
  </div>
  {% endif %}
</div>

<div class="card">
  <h2>ğŸ“ˆ Spending Analytics</h2>
  <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(450px, 1fr)); gap: 24px;">
    <div class="analytics-container">
      <h3 style="margin: 0 0 20px 0; color: #44444E; text-align: center; font-weight: 600; font-size: 1.1rem;">ğŸ·ï¸ Spending by Category</h3>
      <div style="height: 300px; position: relative;">
        <canvas id="categoryChart"></canvas>
      </div>
    </div>
    <div class="analytics-container">
      <h3 style="margin: 0 0 20px 0; color: #44444E; text-align: center; font-weight: 600; font-size: 1.1rem;">ğŸ“Š Daily Spending Trend</h3>
      <div style="height: 300px; position: relative;">
        <canvas id="dailyChart"></canvas>
      </div>
      <div style="margin-top: 16px; padding: 12px; background: rgba(166, 123, 123, 0.05); border-radius: 8px; border-left: 3px solid #A67B7B;">
        <p style="margin: 0; font-size: 0.9rem; color: #6B6B75; text-align: center;">
          ğŸ’¡ <strong>Tip:</strong> Hover over data points to see detailed spending information for each day.
        </p>
      </div>
    </div>
  </div>
</div>

<script src="{{ url_for('static', filename='chart-helper.js') }}"></script>
<script>
  // Load analytics data
  fetch('/api/summary?days=30')
    .then(response => response.json())
    .then(data => {
      // Category chart
      const categoryCtx = document.getElementById('categoryChart').getContext('2d');
      new Chart(categoryCtx, {
        type: 'doughnut',
        data: {
          labels: data.categories.map(c => c.category),
          datasets: [{
            data: data.categories.map(c => c.total),
            backgroundColor: [
              '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0',
              '#9966FF', '#FF9F40', '#FF6384'
            ]
          }]
        },
        options: {
          responsive: true,
          plugins: {
            title: {
              display: true,
              text: 'Spending by Category (Last 30 Days)'
            }
          }
        }
      });

      // Daily spending chart
      const dailyCtx = document.getElementById('dailyChart').getContext('2d');
      new Chart(dailyCtx, {
        type: 'line',
        data: {
          labels: data.daily.map(d => d.date),
          datasets: [{
            label: 'Daily Spending',
            data: data.daily.map(d => d.total),
            borderColor: '#36A2EB',
            backgroundColor: 'rgba(54, 162, 235, 0.1)',
            tension: 0.1
          }]
        },
        options: {
          responsive: true,
          plugins: {
            title: {
              display: true,
              text: 'Daily Spending Trend (Last 30 Days)'
            }
          },
          scales: {
            y: {
              beginAtZero: true
            }
          }
        }
      });
    })
    .catch(error => {
      console.error('Error loading analytics:', error);
    });
</script>
{% endblock %}
